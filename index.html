<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>データ構造アニメーション</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    .controls { margin: 20px; }
    .container {
      display: inline-block;
      vertical-align: top;
      margin: 20px;
      position: relative;
      width: 120px;
      height: 300px;
      border: 2px solid black;
    }
    .queue { border-bottom: none; } /* 底なし */
    .stack { border-bottom: 2px solid black; }
    .box {
      width: 80px;
      height: 30px;
      background: lightblue;
      border: 1px solid #000;
      line-height: 30px;
      margin: 2px auto;
      transition: all 1s;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    #log { margin-top: 20px; height: 120px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; }
    .highlight { background: yellow; }
  </style>
</head>
<body>
  <h1>データ構造アニメーション</h1>
  <div class="controls">
    <select id="structure">
      <option value="stack">Stack</option>
      <option value="queue">Queue</option>
      <option value="hash">Hash</option>
    </select>
    <button onclick="runDemo()">実行</button>
    <label>速度:
      <select id="speed">
        <option value="3000">1</option>
        <option value="2000" selected>2</option>
        <option value="1000">3</option>
      </select>
    </label>
  </div>

  <div id="visual"></div>
  <div id="log"></div>

  <script>
    let boxes = [];
    let speed = 2000;

    function logAction(text) {
      const log = document.getElementById("log");
      const entry = document.createElement("div");
      entry.textContent = text;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function createBox(num, index) {
      const box = document.createElement("div");
      box.className = "box";
      box.textContent = num;
      box.style.bottom = (index * 35 + 5) + "px";
      return box;
    }

    function runDemo() {
      document.getElementById("visual").innerHTML = "";
      document.getElementById("log").innerHTML = "";
      boxes = [];
      speed = parseInt(document.getElementById("speed").value);
      const type = document.getElementById("structure").value;

      if (type === "stack" || type === "queue") {
        const container = document.createElement("div");
        container.className = "container " + type;
        document.getElementById("visual").appendChild(container);

        let values = [1, 2, 3, 4, 5, 6];

        // push/enqueue
        values.forEach((val, i) => {
          setTimeout(() => {
            const box = createBox(val, boxes.length);
            container.appendChild(box);
            boxes.push(box);
            logAction((type === "stack" ? "push " : "enqueue ") + val);
          }, speed * i);
        });

        // pop/dequeue
        values.forEach((val, i) => {
          setTimeout(() => {
            if (boxes.length > 0) {
              let removed;
              if (type === "stack") {
                removed = boxes.pop();
              } else {
                removed = boxes.shift();
              }
              removed.classList.add("highlight");
              setTimeout(() => {
                removed.remove();
                // 再配置
                boxes.forEach((b, idx) => {
                  b.style.bottom = (idx * 35 + 5) + "px";
                });
              }, speed / 2);
              logAction((type === "stack" ? "pop " : "dequeue ") + removed.textContent);
            }
          }, speed * (values.length + i));
        });
      }

      if (type === "hash") {
        const table = document.createElement("table");
        table.border = "1";
        table.style.margin = "auto";
        let size = 7;
        for (let i = 0; i < size; i++) {
          const row = table.insertRow();
          const cell = row.insertCell();
          cell.textContent = i;
          cell.style.width = "50px";
          cell.style.height = "30px";
          cell.style.textAlign = "center";
        }
        document.getElementById("visual").appendChild(table);

        let values = [15, 22, 5, 13];
        values.forEach((val, i) => {
          setTimeout(() => {
            let index = val % size;
            const row = table.rows[index].cells[0];
            row.style.background = "yellow";
            row.textContent = index + " : " + val;
            logAction("insert " + val + " → index " + index);
          }, speed * i);
        });
      }
    }
  </script>
</body>
</html>
