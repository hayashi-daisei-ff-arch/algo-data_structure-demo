<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>データ構造アニメーション</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<style>
  body { text-align:center; font-family:sans-serif; }
  label { display:block; margin-top:5px; }
  #counter { font-weight:bold; margin-top:5px; }
</style>
</head>
<body>
<h2>データ構造アニメーション（スタック／キュー／ハッシュ）</h2>

<label>データ構造選択</label>
<select id="dsSelect">
  <option value="stack">スタック（LIFO）</option>
  <option value="queue">キュー（FIFO）</option>
  <option value="hash">ハッシュ</option>
</select>

<label>入力値</label>
<input type="text" id="inputValue" placeholder="値を入力">

<label>アニメーション速度</label>
<input type="range" id="speedSlider" min="1" max="5" value="3">
<span id="speedValue">3</span>

<button onclick="runAnimation()">実行</button>

<p id="counter">操作数: 0</p>

<script>
let structure = [];
let dsType = 'stack';
let steps = [];
let counter = 0;
let animationRunning = false;
let speed = 3;
let hashSize = 10; // ハッシュテーブルの配列サイズ

function setup(){
  createCanvas(900,300).parent(document.body);
  frameRate(speed*2);
  structure = [];
  drawStructure();
}

function draw(){
  if(animationRunning && counter<steps.length){
    let step = steps[counter];
    if(dsType==='stack' || dsType==='queue'){
      structure = step.slice();
    } else if(dsType==='hash'){
      structure = step.slice();
    }
    drawStructure();
    counter++;
    document.getElementById("counter").innerText="操作数: "+counter;
    if(counter>=steps.length){ animationRunning=false; }
  } else {
    drawStructure();
  }
}

function drawStructure(){
  background(255);
  textAlign(CENTER,CENTER);
  textSize(16);
  fill(0);
  // 描画
  if(dsType==='stack'){
    for(let i=0;i<structure.length;i++){
      let val = structure[i].value;
      let highlight = structure[i].highlight;
      fill(highlight? 'red':'#ccc');
      rect(400, 250 - i*40, 100,30);
      fill(0);
      text(val,450, 265 - i*40);
    }
  } else if(dsType==='queue'){
    for(let i=0;i<structure.length;i++){
      let val = structure[i].value;
      let highlight = structure[i].highlight;
      fill(highlight? 'red':'#ccc');
      rect(100 + i*60, 200, 50,50);
      fill(0);
      text(val,125 + i*60,225);
    }
  } else if(dsType==='hash'){
    for(let i=0;i<hashSize;i++){
      let val = structure[i]?structure[i].value:'';
      let highlight = structure[i]?structure[i].highlight:false;
      fill(highlight?'red':'#ccc');
      rect(50 + i*80,100,70,50);
      fill(0);
      text(val,85+i*80,125);
      fill(0);
      text(i,85+i*80,80);
    }
  }
}

function runAnimation(){
  let inputVal = document.getElementById("inputValue").value;
  dsType = document.getElementById("dsSelect").value;
  speed = parseInt(document.getElementById("speedSlider").value);
  frameRate(speed*2);
  document.getElementById("speedValue").innerText=speed;
  counter=0;
  animationRunning=true;
  steps=[];
  // 初期化
  if(dsType==='stack' || dsType==='queue'){
    structure = [];
    steps.push(structure.map(e=>({value:e.value, highlight:false})));
  } else if(dsType==='hash'){
    structure = new Array(hashSize).fill(null);
    steps.push(structure.map(e=>e?{value:e.value, highlight:false}:null));
  }
  // 追加処理
  if(inputVal==='') return;
  if(dsType==='stack'){
    // push
    structure.push({value:inputVal, highlight:true});
    steps.push(structure.map(e=>({value:e.value, highlight:e.highlight})));
    // pop
    structure[structure.length-1].highlight=true;
    steps.push(structure.map(e=>({value:e.value, highlight:e.highlight})));
    structure.pop();
    steps.push(structure.map(e=>({value:e.value, highlight:false})));
  } else if(dsType==='queue'){
    // enqueue
    structure.push({value:inputVal, highlight:true});
    steps.push(structure.map(e=>({value:e.value, highlight:e.highlight})));
    // dequeue
    if(structure.length>0){
      structure[0].highlight=true;
      steps.push(structure.map(e=>({value:e.value, highlight:e.highlight})));
      structure.shift();
      steps.push(structure.map(e=>({value:e.value, highlight:false})));
    }
  } else if(dsType==='hash'){
    // hash function simple: key % hashSize
    let key = parseInt(inputVal);
    let idx = isNaN(key)?0:key%hashSize;
    structure[idx]={value:inputVal, highlight:true};
    steps.push(structure.map(e=>e?{value:e.value, highlight:e.highlight}:null));
    // clear highlight
    structure[idx].highlight=false;
    steps.push(structure.map(e=>e?{value:e.value, highlight:e.highlight}:null));
  }
}
document.getElementById("speedSlider").addEventListener("input",()=>{
  let val=parseInt(document.getElementById("speedSlider").value);
  document.getElementById("speedValue").innerText=val;
});
</script>
</body>
</html>
