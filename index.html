<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>データ構造アニメーション</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .controls { margin-bottom: 20px; }
    .container { display: inline-block; margin: 20px; vertical-align: top; }
    .box { width: 50px; height: 50px; line-height: 50px; border: 2px solid #333;
           margin: 2px auto; background: lightblue; font-weight: bold; }
    .highlight { background: orange; }
    .structure { border: 2px solid #000; display: inline-block; padding: 10px; min-height: 320px; }
    .queue-row { display: flex; justify-content: center; }
    .hash-table { display: grid; grid-template-columns: repeat(5, 60px); grid-gap: 5px; margin-top: 20px; }
    .cell { border: 2px solid #333; width: 60px; height: 60px; line-height: 60px; }
  </style>
</head>
<body>
  <h1>データ構造アニメーション</h1>
  <div class="controls">
    <label>データ構造を選択:
      <select id="structureSelect">
        <option value="stack">スタック</option>
        <option value="queue">キュー</option>
        <option value="hash">ハッシュ</option>
      </select>
    </label>
    <label>速度:
      <input type="range" id="speedRange" min="1" max="3" value="2">
    </label>
    <button onclick="runAnimation()">実行</button>
  </div>
  <div id="animationArea"></div>
  <p id="status"></p>

  <script>
    const animationArea = document.getElementById("animationArea");
    const status = document.getElementById("status");

    function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    async function runAnimation() {
      animationArea.innerHTML = "";
      status.textContent = "";
      const type = document.getElementById("structureSelect").value;
      const speed = 1000 / document.getElementById("speedRange").value;

      if (type === "stack") {
        await runStack(speed);
      } else if (type === "queue") {
        await runQueue(speed);
      } else {
        await runHash(speed);
      }
    }

    async function runStack(speed) {
      status.textContent = "スタック: push/pop 実行中...";
      const container = document.createElement("div");
      container.className = "structure";
      animationArea.appendChild(container);

      let stack = [];
      for (let i = 1; i <= 6; i++) {
        const box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        container.prepend(box);
        stack.push(box);
        status.textContent = `push ${i}`;
        await sleep(speed);
      }
      while (stack.length > 0) {
        const box = stack.pop();
        box.classList.add("highlight");
        status.textContent = `pop ${box.textContent}`;
        await sleep(speed);
        box.remove();
      }
      status.textContent = "スタック操作完了";
    }

    async function runQueue(speed) {
      status.textContent = "キュー: enqueue/dequeue 実行中...";
      const container = document.createElement("div");
      container.className = "structure";
      animationArea.appendChild(container);
      const row = document.createElement("div");
      row.className = "queue-row";
      container.appendChild(row);

      let queue = [];
      for (let i = 1; i <= 6; i++) {
        const box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        row.appendChild(box);
        queue.push(box);
        status.textContent = `enqueue ${i}`;
        await sleep(speed);
      }
      while (queue.length > 0) {
        const box = queue.shift();
        box.classList.add("highlight");
        status.textContent = `dequeue ${box.textContent}`;
        await sleep(speed);
        box.remove();
      }
      status.textContent = "キュー操作完了";
    }

    async function runHash(speed) {
      status.textContent = "ハッシュ: insert/search 実行中...";
      const table = document.createElement("div");
      table.className = "hash-table";
      animationArea.appendChild(table);

      const cells = [];
      for (let i = 0; i < 10; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = "";
        table.appendChild(cell);
        cells.push(cell);
      }

      const keys = [12, 25, 37, 8, 19];
      for (let key of keys) {
        let idx = key % cells.length;
        cells[idx].textContent = key;
        cells[idx].classList.add("highlight");
        status.textContent = `insert ${key} at index ${idx}`;
        await sleep(speed);
        cells[idx].classList.remove("highlight");
      }

      let searchKey = 19;
      let idx = searchKey % cells.length;
      cells[idx].classList.add("highlight");
      status.textContent = `search ${searchKey}`;
      await sleep(speed);
      cells[idx].classList.remove("highlight");

      if (cells[idx].textContent == searchKey) {
        status.textContent = `${searchKey} found at index ${idx}`;
      } else {
        status.textContent = `${searchKey} not found`;
      }
    }
  </script>
</body>
</html>
