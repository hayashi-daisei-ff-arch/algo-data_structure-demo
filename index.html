<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>データ構造アニメーション</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .controls { margin-bottom: 20px; }
    .structure { border: 3px solid #000; width: 120px; height: 360px;
                 margin: 0 auto; display: flex; flex-direction: column-reverse;
                 align-items: center; justify-content: flex-start; }
    .queue-structure { border: 3px dashed #000; width: 120px; height: 360px;
                       margin: 0 auto; display: flex; flex-direction: column;
                       align-items: center; justify-content: flex-start; }
    .box { width: 80px; height: 40px; margin: 2px; background: lightblue;
           border: 2px solid #333; line-height: 40px; font-weight: bold; }
    .highlight { background: orange !important; }
    .hash-table { margin: 0 auto; border-collapse: collapse; }
    .hash-table td { border: 2px solid #333; width: 100px; height: 40px; text-align: center; }
  </style>
</head>
<body>
  <h1>データ構造アニメーション</h1>
  <div class="controls">
    <label>データ構造を選択:
      <select id="structureSelect">
        <option value="stack">スタック</option>
        <option value="queue">キュー</option>
        <option value="hash">ハッシュ</option>
      </select>
    </label>
    <label>速度:
      <input type="range" id="speedRange" min="1" max="3" value="2">
    </label>
    <button onclick="runAnimation()">実行</button>
  </div>
  <div id="animationArea"></div>
  <p id="status"></p>

  <script>
    const animationArea = document.getElementById("animationArea");
    const status = document.getElementById("status");
    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    async function runAnimation() {
      animationArea.innerHTML = "";
      status.textContent = "";
      const type = document.getElementById("structureSelect").value;
      const speed = 1000 / document.getElementById("speedRange").value;

      if (type === "stack") {
        await runStack(speed);
      } else if (type === "queue") {
        await runQueue(speed);
      } else {
        await runHash(speed);
      }
    }

    // スタック
    async function runStack(speed) {
      status.textContent = "スタック: push/pop 実行中...";
      const container = document.createElement("div");
      container.className = "structure";
      animationArea.appendChild(container);

      let stack = [];
      for (let i = 1; i <= 6; i++) {
        const box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        container.appendChild(box);
        stack.push(box);
        status.textContent = `push ${i}`;
        await sleep(speed);
      }
      while (stack.length > 0) {
        const box = stack.pop();
        box.classList.add("highlight");
        status.textContent = `pop ${box.textContent}`;
        await sleep(speed);
        box.remove();
      }
      status.textContent = "スタック操作完了";
    }

    // キュー
    async function runQueue(speed) {
      status.textContent = "キュー: enqueue/dequeue 実行中...";
      const container = document.createElement("div");
      container.className = "queue-structure";
      animationArea.appendChild(container);

      let queue = [];
      for (let i = 1; i <= 6; i++) {
        const box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        container.appendChild(box);
        queue.push(box);
        status.textContent = `enqueue ${i}`;
        await sleep(speed);
      }
      while (queue.length > 0) {
        const box = queue.shift();
        box.classList.add("highlight");
        status.textContent = `dequeue ${box.textContent}`;
        await sleep(speed);
        box.remove();
      }
      status.textContent = "キュー操作完了";
    }

    // ハッシュ
    async function runHash(speed) {
      status.textContent = "ハッシュ: insert/search 実行中...";
      const table = document.createElement("table");
      table.className = "hash-table";
      animationArea.appendChild(table);

      const SIZE = 10;
      const cells = [];
      for (let i = 0; i < SIZE; i++) {
        const row = document.createElement("tr");
        const idxCell = document.createElement("td");
        idxCell.textContent = i;
        const valCell = document.createElement("td");
        valCell.textContent = "";
        row.appendChild(idxCell);
        row.appendChild(valCell);
        table.appendChild(row);
        cells.push(valCell);
      }

      const keys = [12, 25, 37, 8, 19];
      for (let key of keys) {
        let idx = key % SIZE;
        cells[idx].textContent = key;
        cells[idx].classList.add("highlight");
        status.textContent = `insert ${key} at index = ${key}%${SIZE} = ${idx}`;
        await sleep(speed);
        cells[idx].classList.remove("highlight");
      }

      let searchKey = 21; // 存在しないキー例
      let idx = searchKey % SIZE;
      cells[idx].classList.add("highlight");
      status.textContent = `search ${searchKey} at index = ${idx}`;
      await sleep(speed);
      cells[idx].classList.remove("highlight");

      if (cells[idx].textContent == searchKey) {
        status.textContent = `${searchKey} found at index ${idx}`;
      } else {
        status.textContent = `${searchKey} not found`;
      }
    }
  </script>
</body>
</html>
